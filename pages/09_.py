   "⚡ モニター・AED": [
        {
            "title": "除細動・安全確認",
            "points": [
                "確認: 「私よし、あなたよし、酸素よし（離して）、全員よし」",
                "貼付: 右前胸部ー左側胸部 (心臓を挟む)",
                "禁忌: **パドルの擦り合わせ禁止**",
                "ペースメーカー: 植込み部を避けて貼ればOK"
            ],
            "columns": [
                {
                    "head": "なぜパドルを擦り合わせてはいけない？",
                    "text": """
                    ドラマではよく見ますが、医学的・工学的には**絶対禁忌**です。
                    
                    1. **火傷の原因:** 金属面同士をぶつけると微細な傷（ピッティング）がつきます。通電時、その傷に電流が集中しスパーク（放電火花）が発生、患者が重度の熱傷を負います。
                    2. **故障・事故:** 誤って空中で放電ボタンを押してしまうリスクがあります。
                    
                    ジェルは**「患者の胸に直接塗る」**か、パドルに塗るなら**「合わせるだけ（擦らない）」**で広げてください。
                    """
                },
                {
                    "head": "AEDの「二相性」とは？",
                    "text": """
                    昔のAED（単相性）は一方向にドカンと360J流していましたが、今のAED（二相性）は150J程度です。なぜ弱いのに効くのか？
                    
                    **「行って、帰ってくる」**からです。
                    電流を往復させることで、1回目で除細動しきれなかった心筋細胞を、2回目の逆向き電流が「整える（再分極させる）」働きをします。
                    これにより、少ないエネルギーで効率よく、かつ心筋へのダメージ（焦げ）を最小限にして止めることができます。
                    """
                }
            ]
        }
    ],
    "🚑 救急隊・気道 (EMS)": [
        {
            "title": "気道確保デバイス (SGA)",
            "points": [
                "i-gel: 挿管困難・短頸に有効。カフなし。",
                "LT (ラリンゲアルチューブ): 「食道に入れる」器具。",
                "交換: ROSC後は誤嚥防止のため挿管へ（カフ抜去時の嘔吐に注意）"
            ],
            "columns": [
                {
                    "head": "i-gelの「4時間ルール」とリスク",
                    "text": """
                    i-gelは挿管困難症例（DAM）の救世主ですが、**連続使用はメーカー規定で「4時間まで」**です。
                    
                    **理由: 巨舌 (Macroglossia)**
                    舌の根元の静脈還流を阻害し続けるため、長時間放置すると舌が倍以上に腫れ上がり、**抜いた瞬間に窒息**します。
                    「とりあえずi-gelで朝まで」は禁忌です。ROSCしてICU管理するなら、速やかに気管挿管へ入れ替えてください。
                    """
                },
                {
                    "head": "コンビチューブはなぜ消えた？",
                    "text": """
                    「食道でも気管でもどっちに入ってもOK」という夢のデバイスでしたが、現在はLTに取って代わられました。
                    
                    **理由:** 「今どっちに入っているか？」の判断が複雑で、現場での**誤接続（食道に入っているのに気管ポートで換気してしまう）事故**が多発したためです。
                    「95%食道に入るなら、食道専用（LT）にした方がミスが減る」という思想でLTが標準になりました。
                    """
                }
            ]
        },
        {
            "title": "CO2モニターの読み方",
            "points": [
                "Easy Cap (比色法): P-T-Yの法則",
                "🟪 A: Purple (Problem) → 食道 or 心停止",
                "🟫 B: Tan (Think / 足りない) → CPR不足",
                "🟨 C: Yellow (Yes) → OK"
            ],
            "columns": [
                {
                    "head": "「Tan (茶色)」が出た時の指導法",
                    "text": """
                    B領域（薄い茶色・灰色）が出たら、**「Think（考えろ）」**または**「足りない（タンない）」**と指導します。
                    
                    気管には入っていますが、CO2が低い状態です。
                    * **CPRが弱い（足りない）？** → 「もっと強く押して黄色に変えろ！」
                    * **換気しすぎ？** → 「回数減らせ！」
                    * **チューブが抜けかけ？**
                    
                    思考停止せず、次のアクションを促すための色です。
                    """
                }
            ]
        },
        {
            "title": "メディカルコントロール (MC)",
            "points": [
                "特定行為 (要指示): ルート、輸液、挿管、アドレナリン",
                "包括指示 (判断可): i-gel/LT、血糖測定、BVM",
                "指導: 「救命士は医師の代行。プロトコル厳守」"
            ]
        }
    ],
    "🫀 循環器 (Cardiology)": [
        {
            "title": "ROSC後の評価とPCI",
            "points": [
                "12誘導: ST上昇あればCAG直行 (CT省略推奨)",
                "鑑別: くも膜下出血(SAH)による「たこつぼ型心筋症」",
                "準備: 左上肢ルート、除細動パッド前後(A-P)"
            ],
            "columns": [
                {
                    "head": "ST上昇：心臓か？脳か？",
                    "text": """
                    ROSC後のST上昇は8割以上がACS（心筋梗塞）ですが、SAHなどの脳卒中でも**「神経原性心筋気絶 (Neurogenic Stunned Myocardium)」**としてST上昇や壁運動異常（たこつぼ型）をきたすことがあります。
                    
                    **判断のヒント:**
                    * **壁運動異常の範囲:** 冠動脈の支配領域と一致するか？（一致しないなら脳を疑う）
                    * **神経所見:** 瞳孔不同などがあるか？
                    
                    基本はカテ室直行ですが、迷う場合は「カテ準備中にCTへダッシュ」が現実解です。
                    """
                },
                {
                    "head": "ヘパリン：ERで打つか、カテ室で待つか",
                    "text": """
                    **「解離（Aortic Dissection）を除外するまで打たない」**のが安全策です。
                    もしST上昇の原因が解離による冠動脈閉塞だった場合、ヘパリン投与は致命的（禁忌）になります。
                    
                    **指導:** 「ヘパリンは準備だけして、循環器医に電話で『先に打っていいですか？』と確認する」のが最もスマートな対応です。
                    """
                }
            ]
        },
        {
            "title": "血糖管理の歴史と現在",
            "points": [
                "目標: **144〜180 mg/dL** (Mild Control)",
                "合言葉: 「低血糖は罪、高血糖は悪」",
                "歴史: 厳格管理(80-110)は否定された"
            ],
            "columns": [
                {
                    "head": "なぜ厳格管理は否定されたのか？（Leuven I vs NICE-SUGAR）",
                    "text": """
                    **2001年 Leuven I Study:** 「血糖80-110の厳格管理で死亡率激減！」と報告され、世界中でブームになりました。
                    * **からくり:** 当時は「早期から高カロリー輸液」を行っており、その「医原性高血糖」をインスリンで解毒した効果でした。
                    
                    **2009年 NICE-SUGAR Study:** 「普通の食事管理下で厳格管理をしたら、**低血糖で死ぬ人が増えた**」
                    
                    **現在:** 蘇生後の脳はグルコース欠乏に極めて弱いため、低血糖リスクを冒してまで下げる必要はない。「ちょっと高め（180以下）」くらいが一番脳に優しい管理です。
                    """
                }
            ]
        }
    ],
    "🤝 チームダイナミクス": [
        {
            "title": "リーダーシップ・スキル",
            "points": [
                "宣言: 「私がリーダーをやります」",
                "位置: 足元（全体俯瞰）",
                "Pre-emptive order: 「あと30秒で交代です。次は〇〇さん」",
                "負荷分散: 記録係、タイムキーパーの指名"
            ],
            "columns": [
                {
                    "head": "Closed Loop Communicationの本質",
                    "text": """
                    単なる復唱ではありません。
                    1. 発信者: 「アドレナリン1mg静注して」
                    2. 受信者: 「アドレナリン1mg静注します」（復唱）
                    3. 受信者: **「静注しました」**（完了報告）
                    4. 発信者: **「ありがとう」**（確認）
                    
                    ここまで回って初めてループが閉じます。「やったつもり・言ったつもり」を防ぐ命綱です。
                    """
                }
            ]
        }
    ]
}

# ------------------------------------------------------------------
# 2. アプリケーション設定・メイン処理
# ------------------------------------------------------------------
def main():
    st.set_page_config(page_title="ICLS Instructor Deep Guide", page_icon="🚑", layout="centered")

    # CSSで見た目を調整
    st.markdown("""
        <style>
            /* 全体の余白調整 */
            .block-container {
                padding-top: 1rem !important;
                padding-bottom: 3rem !important;
            }
            /* タブのデザイン */
            .stTabs [data-baseweb="tab-list"] {
                gap: 5px;
                flex-wrap: wrap;
            }
            .stTabs [data-baseweb="tab"] {
                height: 3.5rem;
                background-color: #f1f3f6;
                border-radius: 5px 5px 0 0;
                padding: 0.5rem 1rem;
                font-weight: 600;
                font-size: 0.9rem;
            }
            .stTabs [aria-selected="true"] {
                background-color: #e3f2fd;
                border-bottom: 3px solid #1976d2;
                color: #1976d2;
            }
            /* Expander（通常） */
            .streamlit-expanderHeader {
                font-weight: 700;
                font-size: 1.05rem;
                background-color: #ffffff;
                border: 1px solid #ddd;
                border-radius: 5px;
                margin-top: 5px;
            }
            /* コラム用Expander */
            div[data-testid="stExpander"] div[data-testid="stExpander"] .streamlit-expanderHeader {
                font-size: 0.95rem;
                color: #2e7d32; /* 緑色系 */
                background-color: #e8f5e9;
                border: none;
            }
            div[data-testid="stExpander"] div[data-testid="stExpander"] .streamlit-expanderContent {
                background-color: #f1f8e9;
                font-size: 0.9rem;
            }
        </style>
    """, unsafe_allow_html=True)

    st.title("ICLS Instructor Deep Guide 🚑")
    st.caption("要点から、詳細な医学的背景・うんちくまで網羅した完全版")

    # タブ生成
    tabs = st.tabs(list(ICLS_CONTENT.keys()))

    for i, category in enumerate(ICLS_CONTENT.keys()):
        with tabs[i]:
            for item in ICLS_CONTENT[category]:
                # メインのトピック（要点）
                with st.expander(f"📌 {item['title']}", expanded=False):
                    
                    # 1. 要点（Points）の表示
                    st.markdown("#### ✅ Key Points")
                    for point in item['points']:
                        # 太字強調などの簡易整形
                        point_text = point.replace("**", "<b>").replace("**", "</b>") 
                        st.markdown(f"- {point}", unsafe_allow_html=True)
                    
                    # 2. 詳細コラム（Columns）がある場合のみ表示
                    if "columns" in item:
                        st.markdown("---")
                        st.markdown("#### 📖 深掘りコラム & うんちく")
                        
                        for col in item['columns']:
                            # コラムをサブExpanderとして表示
                            with st.expander(f"🤔 {col['head']}"):
                                st.info(col['text'])

if __name__ == "__main__":
    main()
    import streamlit as st

# ------------------------------------------------------------------
# 1. コンテンツデータ（要点 + 詳細コラム）
# ------------------------------------------------------------------
ICLS_CONTENT = {
    "👶 小児 (Pediatric)": [
        {
            "title": "小児蘇生 4つの鉄則",
            "points": [
                "① 原因は「呼吸」→ 比率は「15 : 2」 (医療者2人)",
                "② 脈があっても「HR < 60」で胸骨圧迫開始",
                "③ 気道確保は「スニッフィングポジション」 (肩枕)",
                "④ AEDパッドは「未就学児」なら小児用 (無ければ成人用)"
            ],
            "columns": [
                {
                    "head": "なぜ「15:2」なのか？（成人と逆の戦略）",
                    "text": """
                    成人の心停止（不整脈原性）と異なり、小児の心停止の9割は**「呼吸原性（窒息・肺炎・溺水）」**です。
                    心臓は元気なのに、酸素が来ないから止まりかけているだけです。
                    
                    成人のCPRでは「中断を減らす（30:2）」が最優先ですが、小児では**「頻繁に酸素を送る（15:2）」**ことが決定的に重要です。
                    30回も圧迫している間、酸素を止めるのは酸欠の子どもにとって致命的です。
                    """
                },
                {
                    "head": "「脈があるのに押す」勇気を持つ基準",
                    "text": """
                    小児にとって「徐脈（HR<60）」は心停止の一歩手前（瀕死）です。
                    しかし「動いている心臓を外から叩く」のは心理的ハードルが高いものです。
                    
                    **自信を持って押すための3つの確信サイン（心肺機能不全）:**
                    1. **意識がない・脱力 (Floppy)**: 持ち上げてダランとするなら脳に血が行っていません。
                    2. **顔色不良 (Pallor/Cyanosis)**: 蒼白、チアノーゼ。
                    3. **四肢冷感**: ショックの兆候。
                    
                    **「60切って、白くて、ダランとしてたら、それは心停止と同じ！」**と判断して押してください。
                    """
                }
            ]
        },
        {
            "title": "高度気道確保後の換気回数",
            "points": [
                "回数: **20〜30回/分** (2〜3秒に1回)",
                "量: **胸が軽く上がる程度** (Small Volume)",
                "リズム: 「1、2、はい！」「1、2、はい！」"
            ],
            "columns": [
                {
                    "head": "ガイドライン2020での「倍増」の理由",
                    "text": """
                    **旧G2015 (10回/分) → 新G2020 (20〜30回/分)** へと劇的に増えました。
                    
                    **理由:**
                    1. **高い代謝率:** 小児は酸素消費量が成人の何倍も多い。
                    2. **呼吸原性停止:** 心停止時点で既に深刻な酸欠とアシドーシス（高CO2）にあるため、これを補正するには多くの換気が必要。
                    3. **エビデンス:** 30回/分以上換気した群の生存率が高かったという研究 (Sutton et al. 2019) が決定打となりました。
                    
                    **注意点:**
                    回数を増やす分、1回量は**「控えめ」**にしてください。肺の圧損傷と胃膨満を防ぐため、「速く、小さく」が合言葉です。
                    """
                }
            ]
        }
    ],
    "🤰 妊産婦 (Maternal)": [
        {
            "title": "妊産婦蘇生の特異点",
            "points": [
                "体位: **用手子宮左方圧排** (Manual Left Uterine Displacement)",
                "気道: 挿管チューブは **0.5〜1.0mm細いもの** (6.0-6.5mm)",
                "PMCD: **「4分で開始、5分で娩出」**",
                "ルート: **横隔膜より上** (上肢) から確保"
            ],
            "columns": [
                {
                    "head": "なぜ「子宮を左に押す」のか？",
                    "text": """
                    仰臥位（仰向け）になると、重たい子宮が**下大静脈（IVC）**を押し潰し、心臓への還流血流が激減します（仰臥位低血圧症候群）。
                    これでは幾ら胸骨圧迫をしてもポンプが空回りします。
                    
                    **注意:** 昔のように「体を傾ける」と圧迫の力が逃げるため、現在は**「体は平ら、子宮だけ手で押す」**が推奨です。蘇生チームに「子宮係」を一人任命しましょう。
                    """
                },
                {
                    "head": "死戦期帝王切開 (PMCD) の本質",
                    "text": """
                    PMCD (Perimortem Cesarean Delivery) は、単に赤ちゃんを助けるためだけの手技ではありません。
                    
                    **「空になった子宮による圧迫を解除し、母体の静脈還流を劇的に改善させて、お母さんを蘇生させる」**ための蘇生手技（Resuscitative Hysterotomy）です。
                    
                    母体が助からなければ胎児も助かりません。「4分経ったら切る」覚悟が、2つの命を救います。
                    """
                }
            ]
        }
    ],
