import streamlit as st

# ------------------------------------------------------------------
# 1. コンテンツデータ（ここを編集して内容を拡充します）
# ------------------------------------------------------------------
# 構造: カテゴリ -> [ { "title": 見出し, "points": [箇条書きリスト] }, ... ]

INSTRUCTOR_GUIDE = {
    "❤️ BLS (一次救命処置)": [
        {
            "title": "胸骨圧迫の質 (High Quality CPR)",
            "points": [
                "深さ: 5cm以上（小児は胸郭の1/3）",
                "テンポ: 100〜120回/分",
                "リコイル: 完全に解除しているか？（圧迫しっぱなしになっていないか）",
                "中断: 10秒以内（交代は5秒以内を目指す）"
            ]
        },
        {
            "title": "人工呼吸",
            "points": [
                "1回1秒かけて胸が上がる程度",
                "過換気を避ける（30:2の場合）",
                "バックバルブマスクのEC法は適切か"
            ]
        }
    ],
    "⚡ モニター・除細動": [
        {
            "title": "安全確認とパドル操作",
            "points": [
                "電極位置: 右鎖骨下・左側胸部（心臓を挟み込む）",
                "接触: 肌に密着しているか",
                "安全確認: 「離れて！私よし、あなたよし、みんなよし」の目視確認",
                "充電中の胸骨圧迫継続（ハンズオフ時間の短縮）"
            ]
        },
        {
            "title": "波形認識",
            "points": [
                "VF/VT: ショック適応。直ちに充電",
                "PEA/心静止: ショック適応外。直ちにCPR再開",
                "アーチファクト（ノイズ）の除外"
            ]
        }
    ],
    "🫁 気道・呼吸管理": [
        {
            "title": "高度な気道確保",
            "points": [
                "適応判断: 換気困難、誤嚥のリスク、長時間の蘇生",
                "器具選択: 声門上器具(SGA) または 気管挿管",
                "挿管手技: 中断は10秒以内（試技中のCPR継続を推奨）"
            ]
        },
        {
            "title": "挿管後の確認・管理",
            "points": [
                "確認手順: ①聴診（心窩部→左右胸部） ②胸郭挙上 ③チューブの曇り ④EtCO2モニター",
                "換気回数: 6秒に1回（10回/分）の非同期換気",
                "過換気の防止（低血圧・脳血流低下の原因）"
            ]
        }
    ],
    "🏥 蘇生後処置 (ROSC後)": [
        {
            "title": "直後の安定化 (ABCDE)",
            "points": [
                "A: 気道は維持されているか",
                "B: SpO2 92-98% 目標、PaCO2 35-45mmHg",
                "C: 収縮期血圧 > 90mmHg、平均血圧 > 65mmHg（輸液・昇圧剤）",
                "D: 意識レベル確認（JCS/GCS）",
                "E: 体温測定（目標体温管理の検討）"
            ]
        },
        {
            "title": "原因検索と治療",
            "points": [
                "12誘導心電図（STEMIならカテーテル室へ）",
                "5H5Tの除外（特に低酸素、循環血液量減少）",
                "CT検査の検討"
            ]
        }
    ],
    "🤝 チームダイナミクス": [
        {
            "title": "リーダーシップ",
            "points": [
                "明確な役割分担の指示",
                "位置取り: 全体が見渡せる足元側など",
                "先読みした指示（Pre-emptive order）ができているか"
            ]
        },
        {
            "title": "コミュニケーション",
            "points": [
                "クローズドループ通信（指示→復唱→実施報告）",
                "建設的介入（間違いを指摘しやすい雰囲気か）",
                "知の共有（Shared Mental Model）: 「今2分経過、次のリズムチェックで〜します」の声掛け"
            ]
        }
    ]
}

# ------------------------------------------------------------------
# 2. アプリケーションのUI構築
# ------------------------------------------------------------------

def main():
    # ページ設定
    st.set_page_config(page_title="ICLS Instructor Guide", page_icon="🚑")

    # サイドバー：カテゴリ選択
    st.sidebar.title("ICLS Guide 🚑")
    st.sidebar.markdown("指導ポイント確認用")
    
    # ラジオボタンでカテゴリを選ぶ
    selected_category = st.sidebar.radio(
        "カテゴリを選択:",
        list(INSTRUCTOR_GUIDE.keys())
    )

    # メインエリア表示
    st.title(selected_category)
    st.markdown("---")

    # 選択されたカテゴリ内のデータをループして表示
    # ここがツリー構造（Expander）を生成する部分
    content_list = INSTRUCTOR_GUIDE[selected_category]
    
    for item in content_list:
        # expander = クリックで開閉するツリー
        with st.expander(f"📌 {item['title']}", expanded=False):
            # 箇条書きを整形して表示
            for point in item['points']:
                st.markdown(f"- {point}")

    # フッター（余白調整など）
    st.markdown("<br><br><br>", unsafe_allow_html=True)
    st.caption("ICLS Instructor Support Tool v1.0")

if __name__ == "__main__":
    main()
